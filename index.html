<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="description" content="">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- The above 4 meta tags *must* come first in the head; any other head content must come *after* these tags -->

    <!-- Title -->
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
    <title>Easy Bus | Home</title>

    <!-- Favicon -->
    <link rel="icon" href="img/core-img/favicon.ico">

    <!-- Core Stylesheet -->
    <link href="style.css" rel="stylesheet">

    <!-- Responsive CSS -->
    <link href="css/responsive.css" rel="stylesheet">
</head>

<body>
    <!-- ***** Preloader Start ***** -->
    <div id="preloader">
        <div class="mosh-preloader"></div>
    </div>

    <!-- ***** Header Area Start ***** -->
    <header class="header_area clearfix">
        <div class="container-fluid h-100">
            <div class="row h-100">
                <!-- Menu Area Start -->
                <div class="col-12 h-100">
                    <div class="menu_area h-100">
                        <nav class="navbar h-100 navbar-expand-lg align-items-center">
                            <!-- Logo -->
                          <!--  <a class="navbar-brand" href="index.html"><img src="" alt="logo"></a> -->

                            <!-- Menu Area -->
                            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mosh-navbar" aria-controls="mosh-navbar" aria-expanded="false" aria-label="Toggle navigation"><span class="navbar-toggler-icon"></span></button>

                            <div class="collapse navbar-collapse justify-content-end" id="mosh-navbar">
                                <ul class="navbar-nav animated" id="nav">
                                    <li class="nav-item active"><a class="nav-link" href="index.html">Home</a></li>
                                    <li class="nav-item dropdown">
                                        <a class="nav-link dropdown-toggle" href="#" id="moshDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Buses</a>
                                        <div class="dropdown-menu" aria-labelledby="moshDropdown">
                                            <button class="dropdown-item" id="Robrob">Robrob</button>
                                            <button class="dropdown-item" id="Alif">Alif</button>
                                            <button class="dropdown-item" id="Bihanga">Bihanga</button>
                                            <button class="dropdown-item" id="Projapoti">Projapoti</button>
                                            <button class="dropdown-item" id="Boishakhi">Boishakhi</button>
                                            <div class="dropdown-divider"></div>
                                           <button class="dropdown-item" id="onnoBus">Others</button>
                                        </div>
                                    </li>
                                    <li class="nav-item"><a class="nav-link" href="###">About Us</a></li>
                                    <li class="nav-item"><a class="nav-link" href="###">Services</a></li>
                                    <li class="nav-item"><a class="nav-link" href="###">Portfolio</a></li>
                                    <li class="nav-item"><a class="nav-link" href="###">Blog</a></li>
                                    <li class="nav-item"><a class="nav-link" href="###">Contact</a></li>
                                </ul>

                            </div>
                        </nav>
                    </div>
                </div>
            </div>
        </div>
    </header>
    <!-- ***** Header Area End ***** -->

    <!-- ***** Welcome Area Start ***** -->
    <section class="welcome_area clearfix" id="home" style="background-image: url(img/bg-img/welcome-bg.png)">
            <!-- Single Hero Slides -->
            <div class="single-hero-slide d-flex align-items-end justify-content-center">
                <div class="hero-slide-content text-center">

                    <div id="map" class="slide-img"></div>
                    <script>
                      	x = navigator.geolocation;

  		                x.getCurrentPosition(success, failure);

  		                function success(position)

  		                 {
                            var myLat = position.coords.latitude;
  			                    var myLong = position.coords.longitude;
                        // Map options
                        var options = {
                          zoom:12,
                          center:{lat:myLat,lng:myLong}
                        }

                        // New map
                        var map = new google.maps.Map(document.getElementById('map'), options);

                        addMarker({
                            coords:{lat:myLat,lng:myLong},
                            //iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                            content:'<h1>Your Location</h1>'
                          })

                        // Listen for click on buttons

                        function textMaker(busName,ans){
                          var yourLocation = ans[0];
                          var busLocation = ans[1].toString();
                          var distance = ans[4];
                          var timeTraffic = ans[5];
                          var time = ans[6];

                          console.log(busLocation);

                          var str = "<h3>"+busName+"</h3>"+"<h3>"+busLocation+"</h3>"+"<h3>"+distance+"</h3>"+"<h3>Time in traffic: "+timeTraffic+"</h3>"+"<h3>Predicted Time : "+time+"</h3>";

                          return str;
                        }

                        google.maps.event.addDomListener(document.getElementById('Robrob'), 'click',async function() {
    					          	var ans = await geocode("robrob");
                            console.log(ans);

                            var str = textMaker("Robrob",ans);

                            addMarker({
                            coords:{lat:ans[2],
								                  	lng:ans[3]},
                            //iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                            content:str
                          })

                        });


                        google.maps.event.addDomListener(document.getElementById('Alif'), 'click',async function() {
    					          	var ans = await geocode("alif");
                            console.log(ans);

                              var str = textMaker("Alif",ans);


    					            	addMarker({
                                  coords:{lat:ans[2],
                                  lng:ans[3]},
                  //iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                                  content:str
                          })

                        });

                        google.maps.event.addDomListener(document.getElementById('Bihanga'), 'click',async function() {
    					          	var ans = await geocode("bihanga");
                            console.log(ans);

                              var str = textMaker("Bihanga",ans);


    					            	addMarker({
                                  coords:{lat:ans[2],
                                  lng:ans[3]},
                  //iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                                  content:str
                          })

                        });


                        google.maps.event.addDomListener(document.getElementById('Projapoti'), 'click',async function() {
    					          	var ans = await geocode("projapoti");
                            console.log(ans);

                              var str = textMaker("Projapoti",ans);


    					            	addMarker({
                                  coords:{lat:ans[2],
                                  lng:ans[3]},
                  //iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                                  content:str
                          })

                        });


                        google.maps.event.addDomListener(document.getElementById('Boishakhi'), 'click',async function() {
    					          	var ans = await geocode("boishakhi");
                            console.log(ans);

                              var str = textMaker("Boishakhi",ans);


    					            	addMarker({
                                  coords:{lat:ans[2],
                                  lng:ans[3]},
                  //iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                                  content:str
                          })

                        });


                      /*  google.maps.event.addListener(map, 'click', function(event){
                          // Add marker
                          addMarker({coords:event.latLng});
                        });

                        /*
                        // Add marker
                        var marker = new google.maps.Marker({
                          position:{lat:42.4668,lng:-70.9495},
                          map:map,
                          icon:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png'
                        });

                        var infoWindow = new google.maps.InfoWindow({
                          content:'<h1>Lynn MA</h1>'
                        });

                        marker.addListener('click', function(){
                          infoWindow.open(map, marker);
                        });


                        // Array of markers
                        var markers = [
                          {
                            coords:{lat:myLat,lng:myLong},
                            iconImage:'https://developers.google.com/maps/documentation/javascript/examples/full/images/beachflag.png',
                            content:'<h1>Your Location</h1>'
                          },
                          {
                            coords:{lat:42.8584,lng:-70.9300},
                            content:'<h1>Amesbury MA</h1>'
                          },
                          {
                            coords:{lat:42.7762,lng:-71.0773}
                          }
                        ];

                        // Loop through markers
                      /*  for(var i = 0;i < markers.length;i++){
                          // Add marker
                          addMarker(markers[i]);
                        }*/


                        // Add Marker Function
                        function addMarker(props){
                          var marker = new google.maps.Marker({
                            position:props.coords,
                            map:map,
                            //icon:props.iconImage
                          });

                          // Check for customicon
                          if(props.iconImage){
                            // Set icon image
                            marker.setIcon(props.iconImage);
                          }

                          // Check content
                          if(props.content){
                            var infoWindow = new google.maps.InfoWindow({
                              content:props.content
                            });

                            marker.addListener('click', function(){
                              infoWindow.open(map, marker);
                            });
                          }
                        }


                          async function geocode(busName){
                          var lat1 = myLat;
                          var long1 = myLong;

                          //http://ec2-18-136-102-102.ap-southeast-1.compute.amazonaws.com/api/v1/tracker/track/newbus?lat=23.7778&long=90.4057
                          var strr = [];
                          await axios.get(`${'https://cors-anywhere.herokuapp.com/'}http://ec2-18-136-102-102.ap-southeast-1.compute.amazonaws.com/api/v1/tracker/track/${busName}?lat=${lat1}&long=${long1}`,)
                          .then(function(response){

                            /*console.log(response.data);

                            console.log(response.data.bus_address);
                            console.log(response.data.bus_location.lat);
                            console.log(response.data.bus_location.long);
                            console.log(response.data.distance.text);
                            console.log(response.data.duration.text);
                            console.log(response.data.duration_in_traffic.text);
                            console.log(response.data.your_position_address);

                            */

                            strr.push(response.data.your_position_address,response.data.bus_address,response.data.bus_location.lat,
                            response.data.bus_location.long,response.data.distance.text,response.data.duration.text,response.data.duration_in_traffic.text);
                          })
                          .catch(function(error){
                            console.log(error);
                          });

                          return strr;
                        }


                      }

                    function failure(){};
                    </script>


                </div>
            </div>
            <!-- Single Hero Slides -->
    </section>
    <!-- ***** Welcome Area End ***** -->


    <!-- ***** Footer Area Start ***** -->
    <footer class="footer-area clearfix">
        <!-- Top Fotter Area -->

        <!-- Fotter Bottom Area -->
        <div class="footer-bottom-area">
            <div class="container h-100">
                <div class="row h-100">
                    <div class="col-12 h-100">
                        <div class="footer-bottom-content h-100 d-md-flex justify-content-between align-items-center">
                            <div class="copyright-text">
                                <p><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
Copyright &copy;<script>document.write(new Date().getFullYear());</script> All rights reserved
<!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
</p>
                            </div>
                            <div class="footer-social-info">
                                <a href="#"><i class="fa fa-pinterest" aria-hidden="true"></i></a>
                                <a href="#"><i class="fa fa-facebook" aria-hidden="true"></i></a>
                                <a href="#"><i class="fa fa-twitter" aria-hidden="true"></i></a>
                                <a href="#"><i class="fa fa-dribbble" aria-hidden="true"></i></a>
                                <a href="#"><i class="fa fa-behance" aria-hidden="true"></i></a>
                                <a href="#"><i class="fa fa-linkedin" aria-hidden="true"></i></a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    <!-- ***** Footer Area End ***** -->
    <script async defer
src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCuabQFSSO6F_0edXfRaHABN02RobWbuAs&callback=initMap">
</script>

    <!-- jQuery-2.2.4 js -->
    <script src="js/jquery-2.2.4.min.js"></script>
    <!-- Popper js -->
    <script src="js/popper.min.js"></script>
    <!-- Bootstrap js -->
    <script src="js/bootstrap.min.js"></script>
    <!-- All Plugins js -->
    <script src="js/plugins.js"></script>
    <!-- Active js -->
    <script src="js/active.js"></script>
</body>

</html>
